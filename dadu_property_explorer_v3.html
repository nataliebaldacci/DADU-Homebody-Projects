<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DADU Property Explorer | Homebody Projects</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        :root {
            --navy: #2c3e50;
            --navy-dark: #1a252f;
            --teal: #6b8fa3;
            --olive: #6b8e4e;
            --olive-dark: #5a7a42;
            --tan: #c9a86c;
            --cream: #f5f5f0;
            --gold: #d4af37;
            --success: #4caf50;
            --warning: #ff9800;
            --error: #e74c3c;
        }
        
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--cream);
            color: #333;
        }
        
        .header {
            background: linear-gradient(135deg, var(--navy) 0%, var(--navy-dark) 100%);
            padding: 12px 25px;
            display: flex;
            align-items: center;
            gap: 20px;
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            color: white;
            text-decoration: none;
        }
        
        .logo-icon {
            width: 36px; height: 36px;
            background: var(--olive);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }
        
        .logo-text { font-size: 16px; font-weight: 700; }
        
        .search-container {
            flex: 1;
            max-width: 500px;
            display: flex;
            background: white;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .search-input {
            flex: 1;
            padding: 10px 15px;
            border: none;
            font-family: inherit;
            font-size: 14px;
        }
        
        .search-input:focus { outline: none; }
        
        .search-btn {
            padding: 10px 20px;
            background: var(--olive);
            color: white;
            border: none;
            font-family: inherit;
            font-weight: 600;
            cursor: pointer;
        }
        
        .search-btn:hover { background: var(--olive-dark); }
        
        .main-container {
            display: flex;
            min-height: calc(100vh - 60px);
        }
        
        .sidebar {
            width: 440px;
            background: white;
            border-right: 1px solid #e0e0e0;
            overflow-y: auto;
            max-height: calc(100vh - 60px);
        }
        
        .property-card { padding: 20px; }
        
        .property-address {
            font-size: 18px;
            font-weight: 700;
            color: var(--navy);
            margin-bottom: 5px;
        }
        
        .property-apn {
            font-size: 12px;
            color: #888;
            margin-bottom: 15px;
            font-family: monospace;
        }
        
        .eligibility-banner {
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .eligibility-banner.eligible {
            background: linear-gradient(135deg, #e8f5e9, #c8e6c9);
            border: 2px solid var(--success);
        }
        
        .eligibility-banner.not-eligible {
            background: linear-gradient(135deg, #ffebee, #ffcdd2);
            border: 2px solid var(--error);
        }
        
        .eligibility-banner.check-required {
            background: linear-gradient(135deg, #fff3e0, #ffe0b2);
            border: 2px solid var(--warning);
        }
        
        .eligibility-icon { font-size: 32px; }
        .eligibility-text h3 { font-size: 16px; margin-bottom: 3px; }
        .eligibility-text p { font-size: 12px; opacity: 0.8; }
        
        .specs-box {
            background: linear-gradient(135deg, var(--navy), var(--navy-dark));
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }
        
        .specs-box h4 { font-size: 14px; margin-bottom: 15px; opacity: 0.9; }
        
        .specs-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .spec-item { text-align: center; }
        
        .spec-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--olive);
        }
        
        .spec-value span { font-size: 14px; opacity: 0.8; }
        .spec-label { font-size: 11px; opacity: 0.7; margin-top: 3px; }
        
        /* Document Section */
        .docs-section {
            margin-bottom: 20px;
        }
        
        .docs-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .docs-title {
            font-size: 14px;
            font-weight: 700;
            color: var(--navy);
        }
        
        .docs-count {
            font-size: 12px;
            color: #888;
        }
        
        .doc-cards {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .doc-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            border: 2px solid transparent;
            transition: all 0.2s;
            position: relative;
        }
        
        .doc-card:hover {
            border-color: var(--olive);
            transform: translateY(-2px);
        }
        
        .doc-card.available {
            background: #e8f5e9;
        }
        
        .doc-card.unavailable {
            background: #f5f5f5;
            opacity: 0.6;
        }
        
        .doc-card .icon {
            font-size: 28px;
            margin-bottom: 8px;
        }
        
        .doc-card .name {
            font-size: 12px;
            font-weight: 600;
            color: var(--navy);
            margin-bottom: 4px;
        }
        
        .doc-card .count {
            font-size: 18px;
            font-weight: 700;
            color: var(--olive);
        }
        
        .doc-card .status {
            font-size: 10px;
            color: #888;
            margin-top: 5px;
        }
        
        .doc-card.available .status {
            color: var(--success);
        }
        
        /* Premium Badge */
        .premium-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: var(--gold);
            color: white;
            font-size: 9px;
            font-weight: 700;
            padding: 3px 6px;
            border-radius: 4px;
        }
        
        /* Free Documents Section */
        .free-docs {
            background: #f0f7f0;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .free-docs h4 {
            font-size: 12px;
            color: var(--olive);
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .free-link {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: white;
            border-radius: 8px;
            margin-bottom: 8px;
            text-decoration: none;
            color: var(--navy);
            font-size: 13px;
            transition: all 0.2s;
        }
        
        .free-link:hover {
            background: var(--olive);
            color: white;
        }
        
        .free-link:last-child {
            margin-bottom: 0;
        }
        
        /* Premium Package */
        .premium-package {
            background: linear-gradient(135deg, #fff8e1, #ffecb3);
            border: 2px solid var(--gold);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }
        
        .premium-package::before {
            content: "‚≠ê PREMIUM";
            position: absolute;
            top: 0;
            right: 0;
            background: var(--gold);
            color: white;
            font-size: 10px;
            font-weight: 700;
            padding: 5px 12px;
            border-bottom-left-radius: 8px;
        }
        
        .premium-package h4 {
            font-size: 16px;
            color: var(--navy);
            margin-bottom: 10px;
        }
        
        .premium-package .price {
            font-size: 28px;
            font-weight: 700;
            color: var(--gold);
            margin-bottom: 10px;
        }
        
        .premium-package .price span {
            font-size: 14px;
            font-weight: 400;
            color: #888;
        }
        
        .premium-features {
            list-style: none;
            margin-bottom: 15px;
        }
        
        .premium-features li {
            font-size: 12px;
            padding: 5px 0;
            color: #555;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .premium-features li::before {
            content: "‚úì";
            color: var(--success);
            font-weight: 700;
        }
        
        .unlock-btn {
            display: block;
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, var(--gold), #b8960c);
            color: white;
            border: none;
            border-radius: 8px;
            font-family: inherit;
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            text-align: center;
            text-decoration: none;
            transition: all 0.2s;
        }
        
        .unlock-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(212, 175, 55, 0.4);
        }
        
        .action-btn {
            display: block;
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            font-family: inherit;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
            text-align: center;
            margin-bottom: 10px;
            transition: all 0.2s;
        }
        
        .action-btn.primary {
            background: var(--olive);
            color: white;
            border: none;
        }
        
        .action-btn.secondary {
            background: white;
            color: var(--navy);
            border: 2px solid var(--navy);
        }
        
        .action-btn:hover {
            transform: translateY(-1px);
        }
        
        /* Map */
        .map-section {
            flex: 1;
            position: relative;
        }
        
        #map {
            width: 100%;
            height: 100%;
        }
        
        .map-overlay {
            position: absolute;
            top: 10px;
            right: 10px;
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.15);
            z-index: 1000;
            max-width: 250px;
        }
        
        .map-overlay h4 {
            font-size: 12px;
            color: var(--navy);
            margin-bottom: 8px;
        }
        
        .map-overlay p {
            font-size: 11px;
            color: #666;
        }
        
        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            text-align: center;
            padding: 40px;
            color: #888;
        }
        
        .empty-state .icon { font-size: 64px; margin-bottom: 20px; }
        .empty-state h3 { font-size: 18px; color: #555; margin-bottom: 10px; }
        .empty-state p { font-size: 14px; max-width: 300px; }
        
        .spinner {
            width: 40px; height: 40px;
            border: 4px solid #e0e0e0;
            border-top-color: var(--olive);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin { to { transform: rotate(360deg); } }
        
        @media (max-width: 900px) {
            .main-container { flex-direction: column; }
            .sidebar { width: 100%; max-height: none; order: 2; }
            .map-section { height: 40vh; order: 1; }
            .doc-cards { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <header class="header">
        <a href="https://nataliebaldacci.github.io/DADU-Homebody-Projects/" class="logo">
            <div class="logo-icon">üè†</div>
            <span class="logo-text">Homebody Projects</span>
        </a>
        
        <div class="search-container">
            <input type="text" id="addressInput" class="search-input" placeholder="Enter Nashville address...">
            <button class="search-btn" onclick="searchProperty()">Search</button>
        </div>
    </header>
    
    <div class="main-container">
        <aside class="sidebar" id="sidebar">
            <div class="empty-state" id="emptyState">
                <div class="icon">üè†</div>
                <h3>Search for a Property</h3>
                <p>Enter a Nashville address to check DADU eligibility and access property documents.</p>
            </div>
            
            <div id="propertyContent" style="display: none;">
                <div class="property-card" id="propertyCard"></div>
            </div>
        </aside>
        
        <section class="map-section">
            <div id="map"></div>
            <div class="map-overlay">
                <h4>üìç Property Lookup</h4>
                <p>Search for any Nashville address to view DADU eligibility and available documents.</p>
            </div>
        </section>
    </div>
    
    <script>
        // ============================================
        // CONFIGURATION
        // ============================================
        const DATA_BASE = 'https://nataliebaldacci.github.io/DADU-Homebody-Projects/';
        const GOOGLE_DRIVE_FOLDER = 'https://drive.google.com/drive/folders/13w8X1Z8uQ8RFAOUjAlY0jnnjFnRnvfLP';
        
        // Data
        let pdfDatabase = {};
        let parcelsData = null;
        let currentProperty = null;
        
        // Map
        let map = null;
        let marker = null;
        
        // Initialize
        document.addEventListener('DOMContentLoaded', async () => {
            initMap();
            await loadData();
        });
        
        function initMap() {
            map = L.map('map').setView([36.16, -86.78], 11);
            L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
                attribution: '¬© OpenStreetMap, ¬© CartoDB'
            }).addTo(map);
        }
        
        async function loadData() {
            // Load PDF database
            try {
                const res = await fetch(DATA_BASE + 'pdf_database_light.json');
                if (res.ok) {
                    pdfDatabase = await res.json();
                    console.log(`Loaded PDF database: ${Object.keys(pdfDatabase).length} APNs`);
                }
            } catch (e) {
                console.log('PDF database not loaded:', e);
            }
            
            // Load parcel data
            try {
                const res = await fetch(DATA_BASE + 'parcels_scored_v2.json');
                if (res.ok) {
                    parcelsData = await res.json();
                    console.log(`Loaded parcels: ${parcelsData.length}`);
                }
            } catch (e) {
                console.log('Parcels data not loaded:', e);
            }
        }
        
        async function searchProperty() {
            const address = document.getElementById('addressInput').value.trim();
            if (!address) return;
            
            document.getElementById('emptyState').style.display = 'none';
            document.getElementById('propertyContent').style.display = 'block';
            document.getElementById('propertyCard').innerHTML = `
                <div style="text-align: center; padding: 40px;">
                    <div class="spinner"></div>
                    <p>Searching property...</p>
                </div>
            `;
            
            try {
                // Geocode
                const geocodeUrl = `https://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer/findAddressCandidates?SingleLine=${encodeURIComponent(address + ', Nashville, TN')}&f=json&outFields=*`;
                const geoRes = await fetch(geocodeUrl);
                const geoData = await geoRes.json();
                
                if (!geoData.candidates || geoData.candidates.length === 0) {
                    throw new Error('Address not found');
                }
                
                const candidate = geoData.candidates[0];
                currentProperty = {
                    lat: candidate.location.y,
                    lon: candidate.location.x,
                    address: candidate.address
                };
                
                // Try to get APN from Nashville parcel service
                let apn = null;
                try {
                    const parcelUrl = `https://services2.arcgis.com/HdTo6HJqh92wn4D8/ArcGIS/rest/services/Parcels_view/FeatureServer/0/query?geometry=${currentProperty.lon},${currentProperty.lat}&geometryType=esriGeometryPoint&inSR=4326&spatialRel=esriSpatialRelIntersects&outFields=*&f=json`;
                    const parcelRes = await fetch(parcelUrl);
                    const parcelData = await parcelRes.json();
                    if (parcelData.features && parcelData.features.length > 0) {
                        const props = parcelData.features[0].attributes;
                        apn = props.APN || props.STANPAR || props.ParcelID || props.apn;
                        currentProperty.parcelData = props;
                    }
                } catch (e) {
                    console.log('Could not fetch parcel data');
                }
                
                // Look up in local data if no APN yet
                if (!apn && parcelsData) {
                    const nearest = findNearestParcel(currentProperty.lat, currentProperty.lon);
                    if (nearest) {
                        apn = nearest.apn || nearest.a || nearest.APN;
                        currentProperty.localData = nearest;
                    }
                }
                
                currentProperty.apn = apn;
                
                // Get document counts
                let docCounts = { pc: 0, cv: 0, pm: 0, ar: 0, t: 0 };
                if (apn && pdfDatabase[apn]) {
                    docCounts = pdfDatabase[apn];
                }
                currentProperty.docs = docCounts;
                
                // Update UI
                updatePropertyCard();
                updateMap();
                
            } catch (error) {
                console.error('Search error:', error);
                document.getElementById('propertyCard').innerHTML = `
                    <div style="text-align: center; padding: 40px;">
                        <div style="font-size: 48px;">‚ö†Ô∏è</div>
                        <p>Address not found. Please try again.</p>
                    </div>
                `;
            }
        }
        
        function findNearestParcel(lat, lon) {
            if (!parcelsData || !Array.isArray(parcelsData)) return null;
            
            let nearest = null;
            let minDist = Infinity;
            
            for (const p of parcelsData) {
                const pLat = p.lat || p.latitude;
                const pLon = p.lon || p.longitude || p.lng;
                if (!pLat || !pLon) continue;
                
                const dist = Math.sqrt(Math.pow(lat - pLat, 2) + Math.pow(lon - pLon, 2));
                if (dist < minDist && dist < 0.001) {
                    minDist = dist;
                    nearest = p;
                }
            }
            
            return nearest;
        }
        
        function updatePropertyCard() {
            const p = currentProperty;
            const parcel = p.parcelData || p.localData || {};
            const docs = p.docs || { pc: 0, cv: 0, pm: 0, ar: 0, t: 0 };
            
            // Determine eligibility
            const zoning = parcel.ZONE_ || parcel.zoning || parcel.z || '';
            const isRZoning = /^R[0-9S]/i.test(zoning);
            const isEligible = isRZoning || parcel.eligible === 1 || parcel.e === 1;
            const hasCovenant = docs.cv > 0 || parcel.has_covenant === 1;
            
            // Calculate DADU specs based on lot size
            const lotSF = parcel.LANDAREA || parcel.lot_sf || parcel.ac * 43560 || 0;
            const maxLiving = lotSF >= 10000 ? 850 : 700;
            const maxFootprint = lotSF >= 10000 ? 1000 : 750;
            
            // Total premium docs
            const totalDocs = (docs.pc || 0) + (docs.cv || 0) + (docs.pm || 0) + (docs.ar || 0);
            
            const html = `
                <div class="property-address">${p.address}</div>
                <div class="property-apn">APN: ${p.apn || 'Searching...'}</div>
                
                <div class="eligibility-banner ${isEligible ? (hasCovenant ? 'check-required' : 'eligible') : 'not-eligible'}">
                    <div class="eligibility-icon">${isEligible ? (hasCovenant ? '‚ö†Ô∏è' : '‚úÖ') : '‚ùå'}</div>
                    <div class="eligibility-text">
                        <h3>${isEligible ? (hasCovenant ? 'Review Covenant' : 'DADU Eligible!') : 'Check Zoning'}</h3>
                        <p>${isEligible ? 'Qualifies under BL2025-1007' : 'May require zoning review'}</p>
                    </div>
                </div>
                
                ${isEligible ? `
                <div class="specs-box">
                    <h4>üìê Your DADU Building Limits</h4>
                    <div class="specs-grid">
                        <div class="spec-item">
                            <div class="spec-value">${maxLiving} <span>SF</span></div>
                            <div class="spec-label">Max Living Area</div>
                        </div>
                        <div class="spec-item">
                            <div class="spec-value">${maxFootprint} <span>SF</span></div>
                            <div class="spec-label">Max Footprint</div>
                        </div>
                        <div class="spec-item">
                            <div class="spec-value">27 <span>FT</span></div>
                            <div class="spec-label">Max Height</div>
                        </div>
                        <div class="spec-item">
                            <div class="spec-value">3-5 <span>FT</span></div>
                            <div class="spec-label">Side Setbacks</div>
                        </div>
                    </div>
                </div>
                ` : ''}
                
                <!-- Document Cards -->
                <div class="docs-section">
                    <div class="docs-header">
                        <span class="docs-title">üìÅ Available Documents</span>
                        <span class="docs-count">${totalDocs} files found</span>
                    </div>
                    
                    <div class="doc-cards">
                        <div class="doc-card ${docs.pc > 0 ? 'available' : 'unavailable'}">
                            <div class="icon">üè†</div>
                            <div class="name">Property Cards</div>
                            <div class="count">${docs.pc || 0}</div>
                            <div class="status">${docs.pc > 0 ? 'Available' : 'Not found'}</div>
                            ${docs.pc > 0 ? '<div class="premium-badge">$5</div>' : ''}
                        </div>
                        
                        <div class="doc-card ${docs.cv > 0 ? 'available' : 'unavailable'}">
                            <div class="icon">üìú</div>
                            <div class="name">Covenants</div>
                            <div class="count">${docs.cv || 0}</div>
                            <div class="status">${docs.cv > 0 ? 'Review needed' : 'None found'}</div>
                            ${docs.cv > 0 ? '<div class="premium-badge">$8</div>' : ''}
                        </div>
                        
                        <div class="doc-card ${docs.pm > 0 ? 'available' : 'unavailable'}">
                            <div class="icon">üìã</div>
                            <div class="name">Permit PDFs</div>
                            <div class="count">${docs.pm || 0}</div>
                            <div class="status">${docs.pm > 0 ? 'Available' : 'Not found'}</div>
                            ${docs.pm > 0 ? '<div class="premium-badge">$9</div>' : ''}
                        </div>
                        
                        <div class="doc-card ${docs.ar > 0 ? 'available' : 'unavailable'}">
                            <div class="icon">üõ∞Ô∏è</div>
                            <div class="name">Aerial Images</div>
                            <div class="count">${docs.ar || 0}</div>
                            <div class="status">${docs.ar > 0 ? 'Available' : 'Not found'}</div>
                            ${docs.ar > 0 ? '<div class="premium-badge">$3</div>' : ''}
                        </div>
                    </div>
                </div>
                
                <!-- Free Documents -->
                <div class="free-docs">
                    <h4>üÜì Free Public Records</h4>
                    <a href="https://maps.nashville.gov/ParcelViewer/?pin=${p.apn || ''}" target="_blank" class="free-link">
                        üó∫Ô∏è Nashville Parcel Viewer
                    </a>
                    <a href="https://epermits.nashville.gov/?#/search?address=${encodeURIComponent(p.address)}" target="_blank" class="free-link">
                        üìã ePermits Search
                    </a>
                    <a href="https://www.padctn.org/prc/property/${p.apn || ''}/card" target="_blank" class="free-link">
                        üìÑ Property Assessment (PADCTN)
                    </a>
                </div>
                
                <!-- Premium Package -->
                ${totalDocs > 0 ? `
                <div class="premium-package">
                    <h4>üì¶ Complete Document Bundle</h4>
                    <div class="price">$19 <span>one-time</span></div>
                    <ul class="premium-features">
                        ${docs.pc > 0 ? `<li>${docs.pc} Property Card${docs.pc > 1 ? 's' : ''} (PDF)</li>` : ''}
                        ${docs.cv > 0 ? `<li>${docs.cv} Covenant Document${docs.cv > 1 ? 's' : ''} (PDF)</li>` : ''}
                        ${docs.pm > 0 ? `<li>${docs.pm} Permit Document${docs.pm > 1 ? 's' : ''} (PDF)</li>` : ''}
                        ${docs.ar > 0 ? `<li>${docs.ar} Aerial Image${docs.ar > 1 ? 's' : ''} (PNG)</li>` : ''}
                        <li>DADU Eligibility Report</li>
                        <li>Building Specs Analysis</li>
                    </ul>
                    <a href="${GOOGLE_DRIVE_FOLDER}?apn=${p.apn}" target="_blank" class="unlock-btn">
                        üîì Unlock All ${totalDocs} Documents
                    </a>
                </div>
                ` : `
                <div style="background: #f5f5f5; padding: 20px; border-radius: 10px; text-align: center; margin-bottom: 20px;">
                    <p style="color: #888; font-size: 13px;">No premium documents found for this property yet.</p>
                </div>
                `}
                
                <a href="dadu_near_me_v2.html?lat=${p.lat}&lon=${p.lon}" class="action-btn primary">
                    üìç Find Nearby DADUs & Contractors
                </a>
            `;
            
            document.getElementById('propertyCard').innerHTML = html;
        }
        
        function updateMap() {
            const p = currentProperty;
            
            if (marker) map.removeLayer(marker);
            
            marker = L.marker([p.lat, p.lon], {
                icon: L.divIcon({
                    className: 'custom-marker',
                    html: '<div style="background: #e74c3c; width: 24px; height: 24px; border-radius: 50%; border: 4px solid white; box-shadow: 0 2px 8px rgba(0,0,0,0.4);"></div>',
                    iconSize: [24, 24],
                    iconAnchor: [12, 12]
                })
            }).addTo(map);
            
            marker.bindPopup(`<strong>${p.address}</strong><br>APN: ${p.apn || 'N/A'}`).openPopup();
            
            map.setView([p.lat, p.lon], 17);
        }
        
        // Enter key handler
        document.getElementById('addressInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') searchProperty();
        });
    </script>
</body>
</html>
